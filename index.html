<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Snake ‚Äì Vanilla JS</title>
  <style>
    :root{
      --bg:#0b1220; --board:#0f172a; --grid:#111827; --snake:#22d3ee; --head:#06b6d4; --food:#f59e0b; --text:#e5e7eb; --muted:#94a3b8; --accent:#22d3ee;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial; background:radial-gradient(1200px 600px at 20% 10%,#0c1630,#070b16), var(--bg); color:var(--text); min-height:100vh; display:grid; place-items:center}
    .wrap{width:min(94vw,720px)}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    h1{font-size:clamp(18px,3.5vw,26px);margin:0;font-weight:800;letter-spacing:.4px}
    .muted{color:var(--muted)}
    .panel{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .stat{background:#0b1020;border:1px solid #1f2937;border-radius:10px;padding:8px 12px}
    .btn{background:var(--accent); color:#001018; border:none; border-radius:10px; padding:10px 14px; font-weight:800; cursor:pointer}
    .btn.secondary{background:#0b1020;color:var(--text);border:1px solid #1f2937}
    .board{aspect-ratio:1/1; width:100%; background:linear-gradient(180deg,#0c162c,var(--board)); border:1px solid #1f2937; border-radius:16px; position:relative; overflow:hidden}
    canvas{width:100%; height:100%; display:block}
    footer{margin-top:10px;text-align:center;color:var(--muted);font-size:.95rem}

    /* On‚Äëscreen controls for mobile */
    .touch{display:grid; grid-template-columns:80px 80px 80px; gap:10px; justify-content:center; margin-top:12px}
    .touch button{height:60px;border-radius:12px;border:1px solid #1f2937;background:#0b1020;color:var(--text);font-weight:700}
    .touch .ghost{visibility:hidden}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>üêç Snake <span class="muted">‚Ä¢ Vanilla JS</span></h1>
      <div class="panel">
        <div class="stat">Score: <strong id="score">0</strong></div>
        <div class="stat">High: <strong id="high">0</strong></div>
        <button id="pauseBtn" class="btn secondary" aria-pressed="false">Pause</button>
        <button id="resetBtn" class="btn">Restart</button>
      </div>
    </header>

    <div class="board">
      <canvas id="game" width="420" height="420" aria-label="Snake game" role="img"></canvas>
    </div>

    <div class="touch" aria-hidden="false">
      <div></div>
      <button data-dir="up">‚ñ≤</button>
      <div></div>
      <button data-dir="left">‚óÄ</button>
      <div class="ghost"></div>
      <button data-dir="right">‚ñ∂</button>
      <div></div>
      <button data-dir="down">‚ñº</button>
      <div></div>
    </div>

    <footer>
      Controls: Arrow keys / WASD ‚Ä¢ Pause: <kbd>P</kbd> ‚Ä¢ Restart: <kbd>R</kbd>
    </footer>
  </div>

  <script>
    // --- Config ---
    const GRID = 21;           // grid size (GRID x GRID)
    const CELL = 20;           // pixel size per cell (canvas internal)
    const SPEED_START = 7;     // frames per second at start
    const SPEED_GROWTH = 0.35; // speed increase per food

    // Colors
    const COLOR = {
      bg: getComputedStyle(document.documentElement).getPropertyValue('--board').trim(),
      grid: getComputedStyle(document.documentElement).getPropertyValue('--grid').trim(),
      snake: getComputedStyle(document.documentElement).getPropertyValue('--snake').trim(),
      head: getComputedStyle(document.documentElement).getPropertyValue('--head').trim(),
      food: getComputedStyle(document.documentElement).getPropertyValue('--food').trim(),
    };

    // --- State ---
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    canvas.width = GRID * CELL;
    canvas.height = GRID * CELL;

    let snake, food, dir, queuedDir, score, high, speed, lastTime = 0, acc = 0, paused = false, over = false;

    function reset(){
      snake = [{x:Math.floor(GRID/2), y:Math.floor(GRID/2)}];
      for(let i=1;i<4;i++) snake.push({x:snake[0].x - i, y:snake[0].y});
      dir = {x:1, y:0};
      queuedDir = dir;
      food = spawnFood();
      score = 0; speed = SPEED_START; over = false; paused = false;
      document.getElementById('score').textContent = score;
      document.getElementById('pauseBtn').setAttribute('aria-pressed','false');
    }

    function spawnFood(){
      while(true){
        const p = {x:rand(0, GRID-1), y:rand(0, GRID-1)};
        if(!snake.some(s => s.x===p.x && s.y===p.y)) return p;
      }
    }

    function rand(min,max){return Math.floor(Math.random()*(max-min+1))+min}

    function tick(dt){
      if(paused || over) return;
      acc += dt;
      const step = 1000 / speed; // ms per frame
      while(acc >= step){
        acc -= step;
        stepGame();
      }
    }

    function stepGame(){
      // apply queued direction if not reversing
      if((queuedDir.x !== -dir.x || queuedDir.y !== -dir.y)) dir = queuedDir;

      const head = {x:snake[0].x + dir.x, y:snake[0].y + dir.y};

      // wall wrap (optional: change to game over by checking bounds)
      head.x = (head.x + GRID) % GRID;
      head.y = (head.y + GRID) % GRID;

      // self collision
      if(snake.some(p => p.x===head.x && p.y===head.y)){
        gameOver();
        return;
      }

      snake.unshift(head);

      // food check
      if(head.x===food.x && head.y===food.y){
        score++; speed += SPEED_GROWTH; food = spawnFood();
        document.getElementById('score').textContent = score;
        saveHigh();
      } else {
        snake.pop();
      }
      draw();
    }

    function draw(){
      // background
      ctx.fillStyle = COLOR.bg;
      ctx.fillRect(0,0,canvas.width,canvas.height);

      // grid dots
      ctx.fillStyle = 'rgba(255,255,255,0.04)';
      for(let y=0;y<GRID;y++){
        for(let x=0;x<GRID;x++){
          ctx.fillRect(x*CELL+CELL/2-1, y*CELL+CELL/2-1, 2, 2);
        }
      }

      // food
      drawCell(food.x, food.y, COLOR.food, 6);

      // snake
      for(let i=snake.length-1;i>=0;i--){
        const s = snake[i];
        drawCell(s.x, s.y, i===0?COLOR.head:COLOR.snake, i===0?4:3);
      }

      if(over){
        banner('Game Over ‚Äì Press R to Restart');
      } else if(paused){
        banner('Paused');
      }
    }

    function drawCell(x,y,color,round=4){
      const px = x*CELL, py = y*CELL;
      const r = round;
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.moveTo(px+r,py);
      ctx.arcTo(px+CELL,py,px+CELL,py+CELL,r);
      ctx.arcTo(px+CELL,py+CELL,px,py+CELL,r);
      ctx.arcTo(px,py+CELL,px,py,r);
      ctx.arcTo(px,py,px+CELL,py,r);
      ctx.closePath();
      ctx.fill();
    }

    function banner(text){
      ctx.fillStyle = 'rgba(0,0,0,0.45)';
      ctx.fillRect(0, canvas.height/2-40, canvas.width, 80);
      ctx.fillStyle = '#e5e7eb';
      ctx.font = 'bold 22px system-ui, -apple-system, Segoe UI, Roboto';
      ctx.textAlign = 'center';
      ctx.fillText(text, canvas.width/2, canvas.height/2+8);
    }

    function gameOver(){
      over = true; draw();
    }

    function loop(ts){
      const dt = ts - lastTime; lastTime = ts;
      tick(dt);
      requestAnimationFrame(loop);
    }

    // --- Input ---
    function setDir(n){ queuedDir = n; }
    const keyMap = {
      ArrowUp:{x:0,y:-1}, KeyW:{x:0,y:-1},
      ArrowDown:{x:0,y:1}, KeyS:{x:0,y:1},
      ArrowLeft:{x:-1,y:0}, KeyA:{x:-1,y:0},
      ArrowRight:{x:1,y:0}, KeyD:{x:1,y:0},
    };

    addEventListener('keydown', (e)=>{
      if(keyMap[e.code]){ e.preventDefault(); setDir(keyMap[e.code]); }
      if(e.code==='KeyP'){ togglePause(); }
      if(e.code==='KeyR'){ reset(); draw(); }
    });

    document.querySelectorAll('[data-dir]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const d = btn.getAttribute('data-dir');
        if(d==='up') setDir({x:0,y:-1});
        if(d==='down') setDir({x:0,y:1});
        if(d==='left') setDir({x:-1,y:0});
        if(d==='right') setDir({x:1,y:0});
      })
    });

    // --- Pause / Reset / High score ---
    document.getElementById('pauseBtn').addEventListener('click', togglePause);
    document.getElementById('resetBtn').addEventListener('click', ()=>{ reset(); draw(); });

    function togglePause(){
      paused = !paused; document.getElementById('pauseBtn').setAttribute('aria-pressed', String(paused)); draw();
    }

    function saveHigh(){
      high = Math.max(score, Number(localStorage.getItem('snake-high')||0));
      localStorage.setItem('snake-high', String(high));
      document.getElementById('high').textContent = high;
    }

    // --- Boot ---
    high = Number(localStorage.getItem('snake-high')||0);
    document.getElementById('high').textContent = high;
    reset();
    draw();
    requestAnimationFrame(loop);
  </script>
</body>
</html>
